<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.1/plotly.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        #parentDist {
            grid-column: 1 / -1;
        }
        .button-container {
            grid-column: 1 / -1;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="button-container">
            <button onclick="generateNewSamples()">Generate New Samples</button>
        </div>
        <div id="parentDist"></div>
        <div id="samples"></div>
        <div id="samplingDist"></div>
    </div>

    <script>
        // Parameters
        const mu = 180;
        const sigma = 20;
        const sampleSize = 20;

        // Generate parent distribution data
        const x = Array.from({length: 100}, (_, i) => mu - 4*sigma + (8*sigma * i/100));
        const y = x.map(val => 
            (1/(sigma * Math.sqrt(2 * Math.PI))) * 
            Math.exp(-0.5 * Math.pow((val - mu)/sigma, 2))
        );

        // Generate samples using Box-Muller transform
        function generateSample() {
            return Array.from({length: sampleSize}, () => {
                let u = 0, v = 0;
                while (u === 0) u = Math.random();
                while (v === 0) v = Math.random();
                return mu + sigma * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
            });
        }

        // Plot parent distribution
        function plotParentDistribution() {
            const trace = {
                x: x,
                y: y,
                type: 'scatter',
                mode: 'lines',
                name: 'Parent Distribution',
                line: { color: 'rgb(31, 119, 180)' }
            };

            const layout = {
                title: 'Parent Normal Distribution (μ=180, σ=20)',
                xaxis: { range: [mu - 3*sigma, mu + 3*sigma] },
                height: 300,
                margin: { t: 40, r: 40, l: 40, b: 40 },
                showlegend: false
            };

            Plotly.newPlot('parentDist', [trace], layout);
        }

        // Plot samples
        function plotSamples(samples, sampleMeans) {
            const data = [];
            
            // Create histograms for each sample
            samples.forEach((sample, i) => {
                data.push({
                    x: sample,
                    type: 'histogram',
                    name: `Sample ${i+1}`,
                    nbinsx: 10,
                    marker: { color: 'rgb(158, 202, 225)' },
                    xaxis: `x${i+1}`,
                    yaxis: `y${i+1}`
                });

                // Add mean line
                data.push({
                    x: [sampleMeans[i], sampleMeans[i]],
                    y: [0, 5],
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: 'red', width: 2 },
                    name: 'Sample Mean',
                    xaxis: `x${i+1}`,
                    yaxis: `y${i+1}`,
                    showlegend: false
                });
            });

            const layout = {
                grid: {rows: 3, columns: 1, pattern: 'independent'},
                height: 600,
                showlegend: false,
                annotations: sampleMeans.map((mean, i) => ({
                    x: mean,
                    y: 4.5,
                    xref: `x${i+1}`,
                    yref: `y${i+1}`,
                    text: `x̄=${mean.toFixed(1)}`,
                    showarrow: false
                }))
            };

            // Set up axes for each subplot
            samples.forEach((_, i) => {
                layout[`xaxis${i+1}`] = { 
                    range: [mu - 3*sigma, mu + 3*sigma],
                    title: i === 2 ? 'Value' : ''
                };
                layout[`yaxis${i+1}`] = { 
                    range: [0, 5],
                    title: `Sample ${i+1} Frequency`
                };
            });

            Plotly.newPlot('samples', data, layout);
        }

        // Plot sampling distribution
        function plotSamplingDistribution(sampleMeans) {
            const samplingX = Array.from({length: 100}, (_, i) => 
                mu - 4*(sigma/Math.sqrt(sampleSize)) + (8*(sigma/Math.sqrt(sampleSize)) * i/100)
            );
            const samplingY = samplingX.map(val => 
                (1/((sigma/Math.sqrt(sampleSize)) * Math.sqrt(2 * Math.PI))) * 
                Math.exp(-0.5 * Math.pow((val - mu)/(sigma/Math.sqrt(sampleSize)), 2))
            );

            const traces = [{
                x: samplingX,
                y: samplingY,
                type: 'scatter',
                mode: 'lines',
                name: 'Sampling Distribution',
                line: { color: 'rgb(31, 119, 180)' }
            }, {
                x: sampleMeans,
                y: Array(3).fill(Math.max(...samplingY) / 2),
                type: 'scatter',
                mode: 'markers',
                marker: { color: 'red', size: 10 },
                name: 'Sample Means'
            }];

            const layout = {
                title: 'Sampling Distribution of Means (n=20)',
                xaxis: { 
                    range: [mu - 3*sigma, mu + 3*sigma],
                    title: 'Sample Mean'
                },
                yaxis: {
                    title: 'Density'
                },
                height: 600,
                showlegend: true
            };

            Plotly.newPlot('samplingDist', traces, layout);
        }

        // Function to generate and plot new samples
        function generateNewSamples() {
            const samples = [
                generateSample(),
                generateSample(),
                generateSample()
            ];
            const sampleMeans = samples.map(sample => 
                sample.reduce((a, b) => a + b, 0) / sample.length
            );
            
            plotSamples(samples, sampleMeans);
            plotSamplingDistribution(sampleMeans);
        }

        // Initial plots
        plotParentDistribution();
        generateNewSamples();
    </script>
</body>
</html>